<pre>
  OEP: 9
  Title: Wallet Standard
  Author: Wyatt Mufson <wyatt@towerbuilders.org>
  Type: Standard
  Status: Draft
  Created: 2019-07-07
</pre>

==Abstract==

The OEP-9 Proposal is a standard for managing wallet files across all Ontology applications.

==Motivation==

There is currently no OEP defining a wallet standard for Ontology.
Different SDKs list their own wallet file specification.
While most are the same, there is not one standard that has been determined.
An established wallet file standard will improve interoperability between applications.

==Specification==

For simplicity I have taken the wallet file specification outlined in the <code>ontology-java-sdk</code>.

===Wallet===

A wallet file in JSON format has the following basic structure:

<pre>
{
  "name": "MyWallet",
  "version": "1.0",
  "scrypt": {},
  "defaultOntid": "did:ont:AT2ka1KAoZWAN2SBBuS62FArq6a4hFxbs2",
  "defaultAccountAddress": "AUJphzUYHZP1JTRD43NRbG8Uo556wgWh3U",
  "createTime": "2018-03-14T03:12:30.862Z",
  "identities": [],
  "accounts": [],
  "extra": null
}
</pre>

The <code>name</code> field is a unique label that the user has given to the wallet file.

The <code>version</code> field is currently fixed at 1.0 and will be used for functional upgrades in the future.

The <code>scrypt</code> field is a ScryptParameters object which describe the parameters of Scrypt algorithm used for encrypting and decrypting the private keys in the wallet.

The <code>defaultOntid</code> field indicates the ontid of the default Identity in the wallet file.

The <code>defaultAccountAddress</code> field indicates the address of the  default Account in the wallet file.

The <code>createTime</code> field is the time that the wallet file was created, in UTC format.

The <code>identities</code> field is an array of Identity objects which describe the details of each Identity in the wallet file.

The <code>accounts</code> field is an array of Account objects which describe the details of each Account in the wallet file.

The <code>extra</code> field is an object that is defined by the implementor of the client for storing extra data.
It is optional and can be left as <code>null</code> if it is not needed.

===ScryptParameters===

The <code>ScryptParameters</code> object has the following structure:

<pre>
{
  "n": 16384,
  "r": 8,
  "p": 8,
  "dkLen" : 64
}
</pre>

The <code>n</code> field is a parameter that defines the CPU/memory cost.
Must be a value 2^N.

The <code>r</code> field is a tuning parameter.

The <code>p</code> field is a tuning parameter (parallelization parameter).
A large value for p can increase computational cost of Scrypt without increasing the memory usage.

The <code>dkLen</code> field is the intended output length in octets of the derived key.

===Identity===

The <code>Identity</code> object has the following structure:

<pre>
{
  "ontid": "did:ont:TQLASLtT6pWbThcSCYU1biVqhMnzhTgLFq",
  "label": "MyIdentity",
  "lock": false,
  "isDefault" : false,
  "controls": []
}
</pre>

The <code>ontid</code> field is the ontid of the Identity.

The <code>label</code> field is a label that the user has given to the Identity.

The <code>lock</code> field indicates whether the Identity is locked by the user - the client shouldn't update the information in a locked Identity.

The <code>isDefault</code> field indicates whether the Identity is the default Identity.

The <code>controls</code> field is an array of Control objects which describes the details of each controller in the Identity.

===Control===

The <code>Control</code> object has the following structure:

<pre>
{
  "algorithm": "ECDSA",
  "parameters": {},
  "id": "1",
  "key": "6PYWB8m1bCnu5bQkRUKAwbZp2BHNvQ3BQRLbpLdTuizpyLkQPSZbtZfoxx",
  "address": "AQkGLumU1tnyJBGV1ZUmD229iQf9KRTTDL",
  "salt": "Rv4v3a4U1zFEq28/"
}
</pre>

The <code>algorithm</code> field is the algorithm used in the encryption system.

The <code>parameters</code> field is an array of parameter objects used in the encryption system.

The <code>id</code> field is the unique id of this control.

The <code>key</code> field is the private key of the Account in the NEP-2 format.
This field can be null (for watch-only addresses or non-standard addresses).

The <code>address</code> field is the address in base58 format.

The <code>salt</code> field is the 16 byte salt value in base64 format.

===Parameter===

Parameter object has the following structure:

<pre>
{
  "curve":"P-256"
}
</pre>

The <code>curve</code> field is the name of the elliptic curve.

===Account===

The <code>Account</code> object has the following structure:

<pre>
{
  "address": "AadQ5xRwrSsFTGzKfLHc1brzykdnf7phhD",
  "label": "a6575fd9",
  "lock": false,
  "algorithm": "ECDSA",
  "parameters": {
    "curve": "P-256"
  },
  "key": "NyfxXX+xKDG2agrDy3espqX7N0k3MysTgqx5FxJGI8bkklZQO6+6BSluyBRvEsOx",
  "enc-alg": "aes-256-gcm",
  "salt": "MHct5XIedi86rQILJFi9lA==",
  "isDefault": false,
  "publicKey": "03e897f5a1ea306270e3e1e539c9065b6905e2430aae7f4802e1114f01634d7235",
  "signatureScheme": "SHA256withECDSA"
}
</pre>

The <code>address</code> field is the base58 encoded address of the Account.

The <code>enc-alg</code> field is the algorithm used to encrypt the private key.

The <code>salt</code> field is the salt value for decryption.

The <code>publicKey</code> field is the public key of the Account.

The <code>signatureScheme</code> field is the signatureScheme used in the signature.

The <code>isDefault</code> field indicates whether the Account is the default Account.

The <code>label</code> field is a label that the user has given to the Account.

The <code>lock</code> field indicates whether the Account is locked by the user - the client shouldn't spend the funds in a locked Account.

The <code>algorithm</code> field is the algorithms used in the encryption system.

The <code>parameters</code> field is an array of parameter objects used in encryption system.

The <code>key</code> field is the private key of the Account in the NEP-2 format.
This field can be null (for watch-only addresses or non-standard addresses).


==Rationale==

The design of this specification is to unify the implementations of the wallet file throughout the SDKs and applications on Ontology.

==Implementation==

Specification for the [[https://github.com/ontio/ontology-java-sdk/blob/master/docs/en/Wallet_File_Specification_en.md | Java SDK]]

Specification for the [[https://github.com/ontio/ontology-ts-sdk/blob/master/docs/en/Wallet_File_Specification.md | TS SDK]]

Specification for the [[https://dev-docs.ont.io/#/docs-en/SDKs/01-wallet-file-specification | Dev Docs]]

Specification for the [[https://github.com/Ryucoin/neovm-utils/blob/master/docs/ont-wallet.md | Swift SDK]]
